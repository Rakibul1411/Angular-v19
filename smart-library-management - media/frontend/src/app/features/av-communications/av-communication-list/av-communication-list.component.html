<div class="min-h-screen bg-gray-50">
  <div class="max-w-7xl mx-auto p-6">

    <!-- Header Section -->
    <div class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-2xl font-semibold text-gray-900">All AVCommunications</h1>
        <p class="text-sm text-gray-500 mt-1">{{ totalRecords() }} Result showing</p>
      </div>
      <div class="flex items-center gap-3">
        <button
          (click)="exportData()"
          class="flex items-center gap-2 px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
          <i class="pi pi-download text-sm"></i>
          <span class="text-sm font-medium">Export</span>
        </button>
        <button
          pButton
          (click)="createNew()"
          class="flex items-center gap-2 px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors">
          <i class="pi pi-plus text-sm"></i>
          <span class="text-sm font-medium">Create New</span>
        </button>
      </div>
    </div>

    <!-- Search and Filters -->
    <div class="bg-white rounded-lg border border-gray-200 mb-4 p-4">
      <div class="flex items-center gap-4">
        <div class="flex-1">
          <div class="relative">
            <i class="pi pi-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            <input
              type="text"
              [(ngModel)]="searchQuery"
              (input)="onSearch()"
              placeholder="Search communications..."
              class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
        </div>
      </div>
    </div>

    <!-- Table Section -->
    <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">

      <p-table
        [value]="filteredCommunications()"
        [loading]="loading()"
        [paginator]="true"
        [rows]="rows()"
        [totalRecords]="totalRecords()"
        [rowsPerPageOptions]="rowsPerPageOptions"
        [first]="first()"
        [tableStyle]="{'min-width': '60rem'}">

        <ng-template pTemplate="header">
          <tr class="border-b border-gray-200">
            <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">
              <div class="flex items-center gap-2">
                <i class="pi pi-hashtag text-xs"></i>
              </div>
            </th>
            <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">
              <div class="flex items-center gap-2">
                <i class="pi pi-file text-xs"></i>
                <span>File</span>
                <i [class]="getSortIcon('fileName')" (click)="onSort('fileName')" class="text-xs cursor-pointer hover:text-blue-600"></i>
              </div>
            </th>
            <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">
              <div class="flex items-center gap-2">
                <i class="pi pi-tag text-xs"></i>
                <span>Type</span>
                <i [class]="getSortIcon('type')" (click)="onSort('type')" class="text-xs cursor-pointer hover:text-blue-600"></i>
              </div>
            </th>
            <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">
              <div class="flex items-center gap-2">
                <i class="pi pi-megaphone text-xs"></i>
                <span>Campaign</span>
                <i [class]="getSortIcon('campaign')" (click)="onSort('campaign')" class="text-xs cursor-pointer hover:text-blue-600"></i>
              </div>
            </th>
            <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">
              <div class="flex items-center gap-2">
                <i class="pi pi-bookmark text-xs"></i>
                <span>Brand</span>
                <i [class]="getSortIcon('brand')" (click)="onSort('brand')" class="text-xs cursor-pointer hover:text-blue-600"></i>
              </div>
            </th>
            <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">
              <div class="flex items-center gap-2">
                <i class="pi pi-user text-xs"></i>
                <span>Created By</span>
                <i [class]="getSortIcon('createdByName')" (click)="onSort('createdByName')" class="text-xs cursor-pointer hover:text-blue-600"></i>
              </div>
            </th>
            <th class="text-left py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">
              <div class="flex items-center gap-2">
                <i class="pi pi-calendar text-xs"></i>
                <span>Created At</span>
                <i [class]="getSortIcon('createdAt')" (click)="onSort('createdAt')" class="text-xs cursor-pointer hover:text-blue-600"></i>
              </div>
            </th>
            <th class="text-center py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-av let-rowIndex="rowIndex">
          <tr class="border-b border-gray-100 hover:bg-gray-50 transition-colors">
            <td class="py-4 px-4 text-sm text-gray-600">
              {{ rowIndex + 1 }}
            </td>

            <td class="py-4 px-4">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg flex items-center justify-center" [ngClass]="getFileIconBgClass(av.mimeType)">
                  <i [class]="getFileIcon(av.mimeType)" [ngClass]="getFileIconClass(av.mimeType)"></i>
                </div>
                <div class="font-medium text-gray-900 text-sm">
                  {{ av.fileName }}
                </div>
              </div>
            </td>

            <td class="py-4 px-4">
              <span class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-purple-100 text-purple-700 rounded text-xs font-medium">
                {{ av.type }}
              </span>
            </td>

            <td class="py-4 px-4 text-sm text-gray-900">
              {{ av.campaign }}
            </td>

            <td class="py-4 px-4">
              <span class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-blue-100 text-blue-700 rounded text-xs font-medium">
                {{ av.brand }}
              </span>
            </td>

            <td class="py-4 px-4">
              <div class="flex items-center gap-2">
                <div class="w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center">
                  <i class="pi pi-user text-xs text-blue-600"></i>
                </div>
                <span class="text-sm text-gray-900">{{ av.createdByName || 'N/A' }}</span>
              </div>
            </td>

            <td class="py-4 px-4 text-sm text-gray-600">
              {{ formatDate(av.createdAt) }}
            </td>

            <td class="py-4 px-4">
              <div class="flex items-center justify-center gap-1">
                <button
                  (click)="viewDetails(av._id)"
                  title="View details"
                  class="w-8 h-8 flex items-center justify-center text-blue-600 hover:bg-blue-50 rounded transition-colors">
                  <i class="pi pi-eye text-sm"></i>
                </button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="8" class="text-center py-12">
              <div class="flex flex-col items-center gap-3">
                <i class="pi pi-inbox text-6xl text-gray-300"></i>
                <p class="text-gray-500 text-lg">No communications found</p>
                <button
                  pButton
                  label="Create First Communication"
                  icon="pi pi-plus"
                  (click)="createNew()"
                  title="Create your first communication"
                  class="mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"></button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="loadingbody">
          <tr>
            <td colspan="8" class="text-center py-12">
              <i class="pi pi-spin pi-spinner text-4xl text-blue-600"></i>
              <p class="text-gray-600 mt-3">Loading communications...</p>
            </td>
          </tr>
        </ng-template>

      </p-table>

      <!-- Success Toast at Bottom -->
      @if (showSuccessToast()) {
        <div class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3 z-50">
          <i class="pi pi-check-circle text-xl"></i>
          <span class="font-medium">AVCommunication Created Successfully</span>
        </div>
      }
    </div>

  </div>
</div>

<!-- Toast for notifications -->
<p-toast position="top-right"></p-toast>

<!-- Confirmation dialog -->
<p-confirmDialog></p-confirmDialog>
