<div class="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
  <p-toast></p-toast>

  <div class="max-w-3xl mx-auto">
    <p-card>
      <ng-template pTemplate="header">
        <div class="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 class="text-2xl font-bold text-gray-900">User Profile</h2>
          <p-button
            icon="pi pi-arrow-left"
            [text]="true"
            [rounded]="true"
            severity="secondary"
            (onClick)="goBack()"
            [pTooltip]="isAdmin && !isOwnProfile ? 'Back to Users' : 'Back to Dashboard'"
            tooltipPosition="left"
          ></p-button>
        </div>
      </ng-template>

      <div class="p-6">
        @if (loading) {
          <div class="space-y-4">
            <p-skeleton width="100%" height="3rem"></p-skeleton>
            <p-skeleton width="100%" height="3rem"></p-skeleton>
            <p-skeleton width="80%" height="3rem"></p-skeleton>
            <p-skeleton width="60%" height="2rem"></p-skeleton>
          </div>
        } @else if (user) {
          @if (!isEditMode) {
            <div class="space-y-6">
              <div class="bg-white rounded-lg p-6 border border-gray-200">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label class="block text-sm font-semibold text-gray-600 mb-2">Full Name</label>
                    <p class="text-lg text-gray-900 font-medium">{{ user.name }}</p>
                  </div>

                  <div>
                    <label class="block text-sm font-semibold text-gray-600 mb-2">Email Address</label>
                    <p class="text-lg text-gray-900">{{ user.email }}</p>
                  </div>

                  <div>
                    <label class="block text-sm font-semibold text-gray-600 mb-2">Role</label>
                    <div>
                      <p-tag
                        [value]="user.role.toUpperCase()"
                        [severity]="getRoleSeverity(user.role)"
                        styleClass="text-sm font-semibold"
                      ></p-tag>
                    </div>
                  </div>

                  @if (user.createdAt) {
                    <div>
                      <label class="block text-sm font-semibold text-gray-600 mb-2">Member Since</label>
                      <p class="text-lg text-gray-700">{{ user.createdAt | date: 'MMM d, y' }}</p>
                    </div>
                  }
                </div>
              </div>

              <div class="flex justify-end pt-4">
                <p-button
                  label="Edit Profile"
                  icon="pi pi-pencil"
                  (onClick)="toggleEditMode()"
                  styleClass="px-6"
                ></p-button>
              </div>
            </div>
          } @else {
            <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
              <div class="space-y-5">
                <div>
                  <label for="name" class="block text-sm font-semibold text-gray-700 mb-2">
                    Full Name <span class="text-red-500">*</span>
                  </label>
                  <input
                    pInputText
                    id="name"
                    type="text"
                    formControlName="name"
                    placeholder="Enter your full name"
                    class="w-full"
                    [class.ng-invalid]="name?.invalid && name?.touched"
                  />
                  @if (name?.invalid && name?.touched) {
                    <small class="block mt-1 text-red-600">
                      @if (name?.errors?.['required']) {
                        Name is required
                      }
                      @if (name?.errors?.['minlength']) {
                        Name must be at least 3 characters
                      }
                    </small>
                  }
                </div>

                <div>
                  <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">
                    Email Address <span class="text-red-500">*</span>
                  </label>
                  <input
                    pInputText
                    id="email"
                    type="email"
                    formControlName="email"
                    placeholder="Enter your email"
                    class="w-full"
                    [class.ng-invalid]="email?.invalid && email?.touched"
                  />
                  @if (email?.invalid && email?.touched) {
                    <small class="block mt-1 text-red-600">
                      @if (email?.errors?.['required']) {
                        Email is required
                      }
                      @if (email?.errors?.['email']) {
                        Invalid email format
                      }
                    </small>
                  }
                </div>

                <div>
                  <label for="password" class="block text-sm font-semibold text-gray-700 mb-2">
                    New Password
                  </label>
                  <small class="block text-gray-500 mb-2">Leave blank to keep current password</small>
                  <p-password
                    id="password"
                    formControlName="password"
                    placeholder="Enter new password"
                    [toggleMask]="true"
                    [feedback]="false"
                    styleClass="w-full"
                    inputStyleClass="w-full"
                  ></p-password>
                </div>

                @if (isAdmin) {
                  <div>
                    <label for="role" class="block text-sm font-semibold text-gray-700 mb-2">Role</label>
                    <p-select
                      id="role"
                      formControlName="role"
                      [options]="roles"
                      placeholder="Select a role"
                      optionLabel="label"
                      optionValue="value"
                      styleClass="w-full"
                    />
                  </div>
                }

                <div class="flex gap-3 justify-end pt-6 border-t border-gray-200">
                  <p-button
                    label="Cancel"
                    icon="pi pi-times"
                    severity="secondary"
                    (onClick)="toggleEditMode()"
                    [disabled]="saving"
                    styleClass="px-5"
                  ></p-button>

                  <p-button
                    label="Save Changes"
                    icon="pi pi-check"
                    type="submit"
                    [loading]="saving"
                    [disabled]="userForm.invalid"
                    styleClass="px-5"
                  ></p-button>
                </div>
              </div>
            </form>
          }
        } @else {
          <div class="text-center py-12">
            <i class="pi pi-user text-gray-400 text-6xl mb-4"></i>
            <p class="text-xl text-gray-600">User not found</p>
            <p class="text-gray-500 mt-2">The requested user profile could not be loaded.</p>
          </div>
        }
      </div>
    </p-card>
  </div>
</div>
