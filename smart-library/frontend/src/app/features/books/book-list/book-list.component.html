<div class="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>

  <div class="max-w-7xl mx-auto">
    <p-card>
      <ng-template pTemplate="header">
        <div class="p-6 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
              <p-button
                icon="pi pi-arrow-left"
                [text]="true"
                [rounded]="true"
                severity="secondary"
                (onClick)="goToDashboard()"
                pTooltip="Back to Dashboard"
                tooltipPosition="bottom"
                styleClass="p-button-lg"
              ></p-button>
              <div>
                <h2 class="text-2xl font-bold text-gray-900">Books Library</h2>
                <p class="text-sm text-gray-600 mt-1">Browse and manage all books in the library</p>
              </div>
            </div>
            @if (isAdmin) {
              <p-button
                label="Add New Book"
                icon="pi pi-plus"
                (onClick)="addNewBook()"
                severity="success"
                styleClass="px-5"
              ></p-button>
            }
          </div>
        </div>
      </ng-template>

      <div class="p-6">
        <div class="mb-6">
          <div class="grid grid-cols-1 md:grid-cols-12 gap-3 items-end">
            <div class="md:col-span-8">
              <label for="search" class="block text-sm font-semibold text-gray-700 mb-2">Search Books</label>
              <span class="p-input-icon-left w-full">
                <i class="pi pi-search"></i>
                <input
                  pInputText
                  id="search"
                  type="text"
                  [(ngModel)]="searchTerm"
                  (keyup.enter)="onSearch()"
                  placeholder="Search by title or author..."
                  class="w-full"
                />
              </span>
            </div>
            <div class="md:col-span-4 flex gap-2">
              <p-button
                label="Search"
                icon="pi pi-search"
                (onClick)="onSearch()"
                styleClass="flex-1"
              ></p-button>
              <p-button
                label="Clear"
                icon="pi pi-times"
                (onClick)="clearSearch()"
                severity="secondary"
                styleClass="flex-1"
              ></p-button>
            </div>
          </div>
        </div>

        <p-table
          [value]="books"
          [loading]="loading"
          [paginator]="true"
          [rows]="10"
          [showCurrentPageReport]="true"
          currentPageReportTemplate="Showing {first} to {last} of {totalRecords} books"
          [rowsPerPageOptions]="[10, 25, 50]"
          styleClass="p-datatable-striped"
          [tableStyle]="{'min-width': '60rem'}"
        >
          <ng-template pTemplate="header">
            <tr>
              <th class="font-semibold" style="width: 25%">Title</th>
              <th class="font-semibold" style="width: 20%">Author</th>
              <th class="font-semibold" style="width: 15%">ISBN</th>
              <th class="font-semibold text-center" style="width: 12%">Total Copies</th>
              <th class="font-semibold text-center" style="width: 12%">Available</th>
              <th class="font-semibold" style="width: 10%">Status</th>
              <th class="font-semibold text-center" style="width: 6%">Actions</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-book>
            <tr>
              <td class="font-medium">{{ book.title }}</td>
              <td>{{ book.author }}</td>
              <td class="font-mono text-sm">{{ book.isbn }}</td>
              <td class="text-center">{{ book.copies }}</td>
              <td class="text-center font-semibold">{{ book.available_copies }}</td>
              <td>
                @if (book.available_copies > 0) {
                  <p-tag severity="success" value="Available"></p-tag>
                } @else {
                  <p-tag severity="danger" value="Out of Stock"></p-tag>
                }
              </td>
              <td>
                <div class="flex gap-2 justify-center">
                  <p-button
                    icon="pi pi-eye"
                    [rounded]="true"
                    [text]="true"
                    severity="info"
                    (onClick)="viewDetails(book)"
                    pTooltip="View Details"
                  ></p-button>

                  @if (isAdmin) {
                    <p-button
                      icon="pi pi-pencil"
                      [rounded]="true"
                      [text]="true"
                      severity="warn"
                      (onClick)="editBook(book)"
                      pTooltip="Edit"
                    ></p-button>

                    <p-button
                      icon="pi pi-trash"
                      [rounded]="true"
                      [text]="true"
                      severity="danger"
                      (onClick)="deleteBook(book)"
                      pTooltip="Delete"
                    ></p-button>
                  }
                </div>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="7" class="text-center py-8">
                <i class="pi pi-book text-gray-400 text-5xl mb-3 block"></i>
                <p class="text-gray-600 text-lg">No books found.</p>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </p-card>
  </div>
</div>
